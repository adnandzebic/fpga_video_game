Open Picoblaze Assembler log for program "software.psm"
Generated by opbasm v 1.2
  Assembled on 2015-11-29T12:31:36
  Picoblaze-6 mode

  Last occupied address: 7FF hex
  Nominal program memory size: 2K (2048)  address(10:0)
  Actual memory size: 4096
  Occupied memory locations: 340
  Memory locations available: 3756
  Scratchpad size: 256


Assembly listing
----------------
000                             ;;============================================================================
000                             ;; File: software.psm
000                             ;; This is the PicoBlaze program for EE178 Lab #8.
000                             ;;============================================================================

000                             ;;============================================================================
000                             ;; Port address declarations.
000                             ;;============================================================================

000                             CONSTANT stax, 00              ; port for 8-bit start-x
000                             CONSTANT stay, 01              ; port for 8-bit start-y
000                             CONSTANT endx, 02              ; port for 8-bit end-x
000                             CONSTANT endy, 03              ; port for 8-bit end-y
000                             CONSTANT busy, 04              ; port for 8-bit busy
000                             CONSTANT beam, 05              ; port for 8-bit beam
000                             CONSTANT mode, 06              ; port for 8-bit mode
000                             CONSTANT prng, 07              ; port for 8-bit prng
000                             CONSTANT leds_lo, 08           ; port for 8-bit led data out
000                             CONSTANT leds_hi, 09           ; port for 8-bit led data out
000                             CONSTANT qssd_lo, 0a           ; port for 8-bit qssd data out
000                             CONSTANT qssd_hi, 0b           ; port for 8-bit qssd data out
000                             CONSTANT qssd_dp, 0c           ; port for 8-bit qssd data out
000                             CONSTANT switches_lo, 0d       ; port for 8-bit switch input
000                             CONSTANT switches_hi, 0e       ; port for 8-bit switch input
000                             CONSTANT buttons, 0f           ; port for 8-bit button input

000                             CONSTANT zero, 00              ; zero
000                             CONSTANT one, 01               ; one

000                             CONSTANT busy_go, 01           ; go command and busy status

000                             CONSTANT beam_hi, 0f           ; beam high intensity
000                             CONSTANT beam_md, 07           ; beam med intensity
000                             CONSTANT beam_lo, 03           ; beam low intensity

000                             CONSTANT mode_hld, 00          ; mode hold framebuffer
000                             CONSTANT mode_clr, 01          ; mode clear framebuffer
000                             CONSTANT mode_lin, 02          ; mode linear decay
000                             CONSTANT mode_exp, 03          ; mode exponential decay

000                             CONSTANT buttons_ct, 10        ; center
000                             CONSTANT buttons_up, 08        ; up
000                             CONSTANT buttons_dn, 04        ; down
000                             CONSTANT buttons_lf, 02        ; left
000                             CONSTANT buttons_rt, 01        ; right

000                             ;;============================================================================
000                             ;; Boot.
000                             ;;============================================================================

000  01000                boot: LOAD s0, zero                  ; initialize
001  01100                      LOAD s1, zero                  ; initialize
002  01200                      LOAD s2, zero                  ; initialize
003  01300                      LOAD s3, zero                  ; initialize
004  01400                      LOAD s4, zero                  ; initialize
005  01B00                      LOAD sb, 00                    ; initial distance
006  01C80                      LOAD sc, 80                    ; starting helicopter position
007  01D05                      LOAD sd, 05                    ; initialize (needed later)
008  01EFF                      LOAD se, FF                    ; load 255 into sE (horizontal coordinate of block)
009  01F62                      LOAD sf, 62                    ; load 108 into sF (vertical coordinate of block)
00A  01503                      LOAD s5, mode_exp              ; load desired mode
00B  2D506                      OUTPUT s5, mode                ; set desired mode
00C  0150F                      LOAD s5, beam_hi               ; load desired beam
00D  2D505                      OUTPUT s5, beam                ; set desired beam
00E  28001                      ENABLE INTERRUPT               ; enable interrupts

00F                             ;;============================================================================
00F                             ;; Main.
00F                             ;;============================================================================

00F  0900F                main: INPUT s0, buttons              ; get center button value
010  0910E                      INPUT s1, switches_hi          ; get hi switch values
011  2D008                      OUTPUT s0, leds_lo             ; put lo led values
012                             ;OUTPUT s1, leds_hi                  ; put hi led values
012  2200F                      JUMP main                      ; go back and repeat

013                             ;;============================================================================
013                             ;; Interrupt - Service Routine.
013                             ;;============================================================================

013  0920F                 isr: INPUT s2, buttons              ; get center button value
014  0930E                      INPUT s3, switches_hi          ; get hi switch values
015  0940F                      INPUT s4, buttons              ; get button values
016                             ;OUTPUT s2, qssd_lo                  ; put lo qssd values
016                             ;OUTPUT s3, qssd_hi                  ; put hi qssd values
016                             ;OUTPUT s4, qssd_dp                  ; put dp qssd values
016                             ;OUTPUT s2, stax                     ; set desired stax
016                             ;OUTPUT s3, stay                     ; set desired stay
016                             ;INPUT s5, prng                      ; load random endx
016                             ;OUTPUT s5, endx                     ; set random endx
016                             ;INPUT s5, prng                      ; load random endy
016                             ;OUTPUT s5, endy                     ; set random endy
016                             ;CALL draw_line                      ; draws a line (careful: this subroutine overwrites s5)
016  20018                      CALL play                      ; call play subroutine
017  29001                      RETURNI ENABLE                 ; done with isr

018                             ;;============================================================================
018                             ;; Play - Play Subroutine
018                             ;;============================================================================

018  0950F                play: INPUT s5, buttons              ; get center button values
019  20022                      CALL map                       ; draw the map using map subroutine

01A  20033                      CALL draw_helicopter           ; draw the helicopter
01B  20065                      CALL random_block_location     ; determines a random place for the block (y direction only)
01C  20038                      CALL draw_block                ; draw the block using draw_block subroutine
01D  20123                      CALL check_collision           ; check if any collisions happen

01E  0950F                      INPUT s5, buttons              ; get button values
01F  1D510                      COMPARE s5, buttons_ct         ; check if center button is pressed
020  30071                      CALL Z, move_heli_up           ; call subroutine that moves the helicopter up

021  25000                      RETURN                         ; finished with play subroutine

022                             ;;============================================================================
022                             ;; Map - Draw Map Subroutine
022                             ;;============================================================================

022                        map:

022                             ;;============================================================================
022                             ;; Draws Top Line of Map (Line 1)
022                             ;;============================================================================

022                             ;; STARTING POINT
022  01500                      LOAD s5, 00                    ; load 00 into s5
023  2D500                      OUTPUT s5, stax                ; set desired stax
024  0160F                      LOAD s6, 0F                    ; load 15 into s5
025  2D601                      OUTPUT s6, stay                ; set desired stay

026                             ;; ENDING POINT
026  015FF                      LOAD s5, FF                    ; set s5 to 255
027  2D502                      OUTPUT s5, endx                ; set desired endx
028  2D603                      OUTPUT s6, endy                ; set desired endy
029  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

02A                             ;;============================================================================
02A                             ;; Draws Bottom Line of Map (Line 2)
02A                             ;;============================================================================

02A                             ;; STARTING POINT
02A  01500                      LOAD s5, 00                    ; load 00 into s5
02B  2D500                      OUTPUT s5, stax                ; set desired stax
02C  016F0                      LOAD s6, F0                    ; load 240 into s5
02D  2D601                      OUTPUT s6, stay                ; set desired stay

02E                             ;; ENDING POINT
02E  015FF                      LOAD s5, FF                    ; set s5 to 255
02F  2D502                      OUTPUT s5, endx                ; set desired endx
030  2D603                      OUTPUT s6, endy                ; set desired endy
031  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)
032  25000                      RETURN                         ; leave map subroutine

033                             ;;============================================================================
033                             ;; Draw Helicopter - Draw Helicopter Subroutine
033                             ;;============================================================================

033            draw_helicopter:

033  20077                      CALL draw_helicopter_cockpit   ; call the subroutine to draw the cockpit
034  200EB                      CALL draw_helicopter_blades    ; call the subroutine to draw the blades
035  200B6                      CALL draw_helicopter_tail      ; call the subroutine to draw the tail
036  200FF                      CALL draw_helicopter_smoke     ; call the subroutine to draw the smoke

037  25000                      RETURN                         ; go back from drawing helicopter


038                             ;;============================================================================
038                             ;; Draw Block - Draw Block Subroutine
038                             ;;============================================================================

038                 draw_block:

038                             ;;============================================================================
038                             ;; Draws Top Line of Block
038                             ;;============================================================================

038  005E0                      LOAD s5, se                    ; load 255 into s5 (horizontal center of block)
039  016E1                      LOAD s6, E1                    ; load 245 into s6
03A  1C650                      COMPARE s6, s5                 ; checking if the block is done "peaking out" from the right (initial compare: 245 ? 255)
03B  3A041                      JUMP C, right_edge             ; jump to right_edge
03C  0160A                      LOAD s6, 0A                    ; load 10 into s6
03D  1C560                      COMPARE s5, s6                 ; comparing s5 and s6
03E  3A045                      JUMP C, left_edge              ; jump to left_edge
03F  32045                      JUMP Z, left_edge              ; jump to left_edge
040  22049                      JUMP in_middle                 ; jump to in_middle

041  2D500          right_edge: OUTPUT s5, stax                ; set desired stax
042  1950A                      SUB s5, 0A                     ;
043  2D502                      OUTPUT s5, endx                ; set desired stax
044  2204C                      JUMP finished1                 ; jump to draw_ys

045  2D500           left_edge: OUTPUT s5, stax                ; set desired stax
046  01600                      LOAD s6, 00                    ; put 255 into s5
047  2D602                      OUTPUT s6, endx                ; set desired stax
048  2204C                      JUMP finished1                 ; jump to draw_ys

049                  in_middle:
049  2D500                      OUTPUT s5, stax                ; set desired stax
04A  1950A                      SUB s5, 0A                     ; subtract the width of block to get the other x coordinate
04B  2D502                      OUTPUT s5, endx                ; set desired endx

04C  2DF01           finished1: OUTPUT sf, stay                ; set desired stay
04D  2DF03                      OUTPUT sf, endy                ; set desired endy
04E  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

04F                             ;;============================================================================
04F                             ;; Draws Bottom Line of Block
04F                             ;;============================================================================

04F  005F0                      LOAD s5, sf                    ; load sF into s5
050  1153C                      ADD s5, 3C                     ; add 40 to s5
051  2D501                      OUTPUT s5, stay                ; set desired stay
052  2D503                      OUTPUT s5, endy                ; set desired endy
053  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

054                             ;;============================================================================
054                             ;; Draws Right Vertical Line of Block
054                             ;;============================================================================

054  2DE00                      OUTPUT se, stax                ; set desired stax
055  2DE02                      OUTPUT se, endx                ; set desired endx
056  2DF01                      OUTPUT sf, stay                ; set desired stay
057  005F0                      LOAD s5, sf                    ; load sF into s5
058  1153C                      ADD s5, 3C                     ; add 60 to y coordinate
059  2D503                      OUTPUT s5, endy                ; set desired endy
05A  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

05B                             ;;============================================================================
05B                             ;; Draws Left Vertical Line of Block
05B                             ;;============================================================================

05B  005E0                      LOAD s5, se                    ; load sE into s5
05C  1950A                      SUB s5, 0A                     ; subtract 10 from s5
05D  2D500                      OUTPUT s5, stax                ; set desired stax
05E  2D502                      OUTPUT s5, endx                ; set desired endx
05F  2DF01                      OUTPUT sf, stay                ; set desired stay
060  005F0                      LOAD s5, sf                    ; load sF into s5
061  1153C                      ADD s5, 3C                     ; add 60 to y coordinate
062  2D503                      OUTPUT s5, endy                ; set desired endy
063  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)
064  25000                      RETURN                         ; finished with draw_block subroutine



065                             ;;============================================================================
065                             ;; Random Block Location - Random Block Location Subroutine
065                             ;;============================================================================

065        random_block_location:
065  1DE00                      COMPARE se, 00                 ; is it time to create a new variable?
066  32069                      JUMP Z, new_random             ; jump to new random creator
067  36068                      JUMP NZ, skip_everything       ; goes back

068  25000     skip_everything: RETURN                         ; returns back (no new rand. number)

069  09507          new_random: INPUT s5, prng                 ; create to new random number
06A  1D50F                      COMPARE s5, 0F                 ; check if it's in range
06B  3E06D                      JUMP NC, check_other_bound_range ; check lower bound of map
06C  3A069                      JUMP C, new_random             ; get new variable

06D        check_other_bound_range:
06D  1D5B4                      COMPARE s5, B4                 ; compare s5 to 180
06E  3E069                      JUMP NC, new_random            ; get a new random number
06F  00F50                      LOAD sf, s5                    ; a new y coordinate generated
070  25000                      RETURN                         ; get out of subroutine

071                             ;;============================================================================
071                             ;; Move Helicopter Up - Move Helicopter Up Subroutine
071                             ;;============================================================================

071               move_heli_up:
071  1DC15                      COMPARE sc, 15                 ; check if the helicopter is colliding with top wall
072  36075                      JUMP NZ, decrement             ; if not colliding, then move helicopter appropriately
073  3E075                      JUMP NC, decrement             ; necessary as well
074  25000                      RETURN                         ; do not increment if colliding with top wall
075                  decrement:
075  19C02                      SUB sc, 02                     ; move the helicopter up
076  25000                      RETURN                         ; get out of subroutine

077                             ;;============================================================================
077                             ;; Draw Helicopter Cockpit - Draw Helicopter Cockpit Subroutine
077                             ;;============================================================================

077        draw_helicopter_cockpit:

077                             ;;============================================================================
077                             ;; Draws Cockpit of Helicopter (Line 1a)
077                             ;;============================================================================

077                             ;; STARTING POINT
077  01564                      LOAD s5, 64                    ; load 100 into s5
078  2D500                      OUTPUT s5, stax                ; set desired stax
079  006C0                      LOAD s6, sc                    ; load sC into s5
07A  2D601                      OUTPUT s6, stay                ; set desired stay

07B                             ;; ENDING POINT
07B  19501                      SUB s5, 01                     ; subtract 7 from s5
07C  2D502                      OUTPUT s5, endx                ; set desired endx
07D  19603                      SUB s6, 03                     ; go up by 5
07E  2D603                      OUTPUT s6, endy                ; set desired endy
07F  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

080                             ;;============================================================================
080                             ;; Draws Cockpit of Helicopter (Line 1b)
080                             ;;============================================================================

080                             ;; STARTING POINT
080  01564                      LOAD s5, 64                    ; load 100 into s5
081  19501                      SUB s5, 01                     ; subtract 7 from s5
082  2D500                      OUTPUT s5, stax                ; set desired stax
083  006C0                      LOAD s6, sc                    ; load sC into s5
084  19603                      SUB s6, 03                     ; go up by 5
085  2D601                      OUTPUT s6, stay                ; set desired stay

086                             ;; ENDING POINT
086  19504                      SUB s5, 04                     ; subtract 7 from s5
087  2D502                      OUTPUT s5, endx                ; set desired endx
088  19602                      SUB s6, 02                     ; go up by 5
089  2D603                      OUTPUT s6, endy                ; set desired endy
08A  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)


08B                             ;;============================================================================
08B                             ;; Draws Cockpit of Helicopter (Line 2a)
08B                             ;;============================================================================

08B                             ;; STARTING POINT
08B  01564                      LOAD s5, 64                    ; load 100 into s5
08C  2D500                      OUTPUT s5, stax                ; set desired stax
08D  006C0                      LOAD s6, sc                    ; load sC into s5
08E  2D601                      OUTPUT s6, stay                ; set desired stay

08F                             ;; ENDING POINT
08F  19501                      SUB s5, 01                     ; subtract 1 from s5
090  2D502                      OUTPUT s5, endx                ; set desired endx
091  11603                      ADD s6, 03                     ; go down by 3
092  2D603                      OUTPUT s6, endy                ; set desired endy
093  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

094                             ;;============================================================================
094                             ;; Draws Cockpit of Helicopter (Line 2b)
094                             ;;============================================================================

094                             ;; STARTING POINT
094  01564                      LOAD s5, 64                    ; load 100 into s5
095  19501                      SUB s5, 01                     ; subtract 1 from s5
096  2D500                      OUTPUT s5, stax                ; set desired stax
097  006C0                      LOAD s6, sc                    ; load sC into s5
098  11603                      ADD s6, 03                     ; go down by 3
099  2D601                      OUTPUT s6, stay                ; set desired stay

09A                             ;; ENDING POINT
09A  19504                      SUB s5, 04                     ; subtract 7 from s5
09B  2D502                      OUTPUT s5, endx                ; set desired endx
09C  11602                      ADD s6, 02                     ; go down by 5
09D  2D603                      OUTPUT s6, endy                ; set desired endy
09E  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

09F                             ;;============================================================================
09F                             ;; Draws Cockpit of Helicopter (Line 3)
09F                             ;;============================================================================

09F                             ;; STARTING POINT
09F  01564                      LOAD s5, 64                    ; load 100 into s5
0A0  19505                      SUB s5, 05                     ; load 7 into s5
0A1  2D500                      OUTPUT s5, stax                ; set desired stax
0A2  006C0                      LOAD s6, sc                    ; load sC into s5
0A3  19605                      SUB s6, 05                     ; go up by 5 using subtraction
0A4  2D601                      OUTPUT s6, stay                ; set desired stay

0A5                             ;; ENDING POINT
0A5  19507                      SUB s5, 07                     ; subtract 5 from s5
0A6  2D502                      OUTPUT s5, endx                ; set desired endx
0A7  11605                      ADD s6, 05                     ; go down by 5
0A8  2D603                      OUTPUT s6, endy                ; set desired endy
0A9  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0AA                             ;;============================================================================
0AA                             ;; Draws Cockpit of Helicopter (Line 4)
0AA                             ;;============================================================================

0AA                             ;; STARTING POINT
0AA  01564                      LOAD s5, 64                    ; load 100 into s5
0AB  19505                      SUB s5, 05                     ; load 7 into s5
0AC  2D500                      OUTPUT s5, stax                ; set desired stax
0AD  006C0                      LOAD s6, sc                    ; load sC into s5
0AE  11605                      ADD s6, 05                     ; go down by 5 using addition
0AF  2D601                      OUTPUT s6, stay                ; set desired stay

0B0                             ;; ENDING POINT
0B0  19507                      SUB s5, 07                     ; subtract 5 from s5
0B1  2D502                      OUTPUT s5, endx                ; set desired endx
0B2  19605                      SUB s6, 05                     ; go back up by 5
0B3  2D603                      OUTPUT s6, endy                ; set desired endy
0B4  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0B5  25000                      RETURN                         ; go back from subroutine

0B6                             ;;============================================================================
0B6                             ;; Draw Helicopter Tail - Draw Helicopter Tail Subroutine
0B6                             ;;============================================================================

0B6        draw_helicopter_tail:

0B6                             ;;============================================================================
0B6                             ;; Draws Tail of Helicopter (Line 1)
0B6                             ;;============================================================================

0B6                             ;; STARTING POINT
0B6  01564                      LOAD s5, 64                    ; load 100 into s5
0B7  1950A                      SUB s5, 0A                     ; subtract 0xA from s5
0B8  2D500                      OUTPUT s5, stax                ; set desired stax
0B9  006C0                      LOAD s6, sc                    ; load sC into s5
0BA  19602                      SUB s6, 02                     ; subtract 2 from s6
0BB  2D601                      OUTPUT s6, stay                ; set desired stay

0BC                             ;; ENDING POINT
0BC  19507                      SUB s5, 07                     ; subtract 7 from s5
0BD  2D502                      OUTPUT s5, endx                ; set desired endx
0BE  2D603                      OUTPUT s6, endy                ; set desired endy
0BF  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0C0                             ;;============================================================================
0C0                             ;; Draws Tail of Helicopter (Line 2)
0C0                             ;;============================================================================

0C0                             ;; STARTING POINT
0C0  01564                      LOAD s5, 64                    ; load 100 into s5
0C1  1950C                      SUB s5, 0C                     ; subtract 0xC from s5
0C2  2D500                      OUTPUT s5, stax                ; set desired stax
0C3  006C0                      LOAD s6, sc                    ; load sC into s5
0C4  2D601                      OUTPUT s6, stay                ; set desired stay

0C5                             ;; ENDING POINT
0C5  19508                      SUB s5, 08                     ; subtract 7 from s5
0C6  2D502                      OUTPUT s5, endx                ; set desired endx
0C7  2D603                      OUTPUT s6, endy                ; set desired endy
0C8  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0C9                             ;;============================================================================
0C9                             ;; Draws Tail of Helicopter (Line 3)
0C9                             ;;============================================================================

0C9                             ;; STARTING POINT
0C9  01564                      LOAD s5, 64                    ; load 100 into s5
0CA  1950A                      SUB s5, 0A                     ; subtract 0x0A from s5
0CB  19508                      SUB s5, 08                     ; subtract 0x10 from s5
0CC  2D500                      OUTPUT s5, stax                ; set desired stax
0CD  006C0                      LOAD s6, sc                    ; load sC into s5
0CE  19602                      SUB s6, 02                     ; subtract 2 from s6
0CF  2D601                      OUTPUT s6, stay                ; set desired stay

0D0                             ;; ENDING POINT
0D0  19502                      SUB s5, 02                     ; subtract 2 from s5
0D1  2D502                      OUTPUT s5, endx                ; set desired endx
0D2  19602                      SUB s6, 02                     ; subtract 2 from s6
0D3  2D603                      OUTPUT s6, endy                ; set desired endy
0D4  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0D5                             ;;============================================================================
0D5                             ;; Draws Tail of Helicopter (Line 4)
0D5                             ;;============================================================================

0D5                             ;; STARTING POINT
0D5  01564                      LOAD s5, 64                    ; load 100 into s5
0D6  1950C                      SUB s5, 0C                     ; subtract 0x0C from s5
0D7  19509                      SUB s5, 09                     ; subtract 0x09 from s5
0D8  2D500                      OUTPUT s5, stax                ; set desired stax
0D9  006C0                      LOAD s6, sc                    ; load sC into s5
0DA  2D601                      OUTPUT s6, stay                ; set desired stay

0DB                             ;; ENDING POINT
0DB                             ;SUB s5, 01                          ; subtract 2 from s5
0DB  2D502                      OUTPUT s5, endx                ; set desired endx
0DC  11601                      ADD s6, 01                     ; add 1 to s6
0DD  2D603                      OUTPUT s6, endy                ; set desired endy
0DE  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0DF                             ;;============================================================================
0DF                             ;; Draws Tail of Helicopter (Line 5)
0DF                             ;;============================================================================

0DF                             ;; STARTING POINT
0DF  01564                      LOAD s5, 64                    ; load 100 into s5
0E0  1950A                      SUB s5, 0A                     ; subtract 0x0A from s5
0E1  1950A                      SUB s5, 0A                     ; subtract 0x0A from s5
0E2  2D500                      OUTPUT s5, stax                ; set desired stax
0E3  006C0                      LOAD s6, sc                    ; load sC into s5
0E4  19604                      SUB s6, 04                     ; subtract 4 from s6
0E5  2D601                      OUTPUT s6, stay                ; set desired stay

0E6                             ;; ENDING POINT
0E6  2D502                      OUTPUT s5, endx                ; set desired endx
0E7  11605                      ADD s6, 05                     ; add 1 to s6
0E8  2D603                      OUTPUT s6, endy                ; set desired endy
0E9  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0EA  25000                      RETURN                         ; go back from subroutine

0EB                             ;;============================================================================
0EB                             ;; Draw Helicopter Blades - Draw Helicopter Blades Subroutine
0EB                             ;;============================================================================

0EB        draw_helicopter_blades:

0EB                             ;;============================================================================
0EB                             ;; Draws Blades of Helicopter (Line 1)
0EB                             ;;============================================================================

0EB                             ;; STARTING POINT
0EB  01564                      LOAD s5, 64                    ; load 100 into s5
0EC  19505                      SUB s5, 05                     ; subtract 0xA from s5
0ED  2D500                      OUTPUT s5, stax                ; set desired stax
0EE  006C0                      LOAD s6, sc                    ; load sC into s5
0EF  19605                      SUB s6, 05                     ; subtract 2 from s6
0F0  2D601                      OUTPUT s6, stay                ; set desired stay

0F1                             ;; ENDING POINT
0F1  2D502                      OUTPUT s5, endx                ; set desired endx
0F2  19602                      SUB s6, 02                     ; subtract 2 from s6
0F3  2D603                      OUTPUT s6, endy                ; set desired endy
0F4  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0F5                             ;;============================================================================
0F5                             ;; Draws Blades of Helicopter (Line 2)
0F5                             ;;============================================================================

0F5                             ;; STARTING POINT
0F5  01564                      LOAD s5, 64                    ; load 100 into s5
0F6  2D500                      OUTPUT s5, stax                ; set desired stax
0F7  006C0                      LOAD s6, sc                    ; load sC into s5
0F8  19607                      SUB s6, 07                     ; subtract 2 from s6
0F9  2D601                      OUTPUT s6, stay                ; set desired stay

0FA                             ;; ENDING POINT
0FA  1950A                      SUB s5, 0A                     ; subtract 10 from s5
0FB  2D502                      OUTPUT s5, endx                ; set desired endx
0FC  2D603                      OUTPUT s6, endy                ; set desired endy
0FD  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)

0FE  25000                      RETURN                         ; go back from subroutine

0FF                             ;;============================================================================
0FF                             ;; Draw Helicopter Smoke - Draw Helicopter Smoke Subroutine
0FF                             ;;============================================================================

0FF        draw_helicopter_smoke:

0FF                             ;;============================================================================
0FF                             ;; Draws Smoke of Helicopter (Line 1)
0FF                             ;;============================================================================

0FF                             ;; Start Point
0FF  01564                      LOAD s5, 64                    ; load 100 into s5
100  19528                      SUB s5, 28                     ; position starting smoke right point of line 1
101  2D500                      OUTPUT s5, stax                ; output to starting x position of line 1

102  006C0                      LOAD s6, sc                    ; load helicopter smoke vertical position for line 1
103  2D601                      OUTPUT s6, stay                ; output to starting y position of line 1
104                             ;;

104                             ;; End Point
104  19504                      SUB s5, 04                     ; position starting smoke left point of line 1
105  2D502                      OUTPUT s5, endx                ; output to starting y position of line 1

106  2D603                      OUTPUT s6, endy                ; output to ending y position of line 1, matching helicopter
107  2011D                      CALL draw_line                 ;draws a line (careful: this subroutine overwrites s5)
108                             ;;

108                             ;;============================================================================
108                             ;; Draws Smoke of Helicopter (Line 2)
108                             ;;============================================================================

108                             ;; Start Point
108  01564                      LOAD s5, 64                    ; load 100 into s5
109  19534                      SUB s5, 34                     ; position starting smoke right point of line 2
10A  2D500                      OUTPUT s5, stax                ; output to starting x position of line 2

10B  006C0                      LOAD s6, sc                    ; load starting smoke vertical position for line 2
10C  11604                      ADD s6, 04                     ; add 4 to s6 (shift down by 4)
10D  2D601                      OUTPUT s6, stay                ; output to starting y position of line 2
10E                             ;;

10E                             ;; End Point
10E  19504                      SUB s5, 04                     ; subtract s5 by 4 for length of line
10F  2D502                      OUTPUT s5, endx                ; output to endx

110  2D603                      OUTPUT s6, endy                ; outputs vertical locaton of smoke line 2
111  2011D                      CALL draw_line                 ;draws a line (careful: this subroutine overwrites s5)
112                             ;;

112                             ;;============================================================================
112                             ;; Draws Smoke of Helicopter (Line 3)
112                             ;;============================================================================

112                             ;; Start Point
112  01564                      LOAD s5, 64                    ; load 100 into s5
113  19540                      SUB s5, 40                     ; position starting smoke right point of line 3
114  2D500                      OUTPUT s5, stax                ; output to starting x position of line 3

115  006C0                      LOAD s6, sc                    ; load starting smoke vertical position for line 3
116  19604                      SUB s6, 04                     ; add 4 to s6 (shift down by 4)
117  2D601                      OUTPUT s6, stay                ; output to starting y position of line 3
118                             ;;

118                             ;; End Point
118  19504                      SUB s5, 04                     ; subtract s5 by 4 for length of line
119  2D502                      OUTPUT s5, endx                ; output to endx

11A  2D603                      OUTPUT s6, endy                ; output same y position of line 3
11B  2011D                      CALL draw_line                 ; draws a line (careful: this subroutine overwrites s5)
11C                             ;;

11C  25000                      RETURN                         ; go back to subroutine



11D                             ;;============================================================================
11D                             ;; Draw Line - Draw Line Subroutine
11D                             ;;============================================================================

11D  01501           draw_line: LOAD s5, busy_go               ; load go command
11E  2D504                      OUTPUT s5, busy                ; send go command
11F  09504                wait: INPUT s5, busy                 ; read busy status
120  1D501                      COMPARE s5, busy_go            ; check busy status
121  3211F                      JUMP Z, wait                   ; if busy, wait more
122  25000                      RETURN                         ; leave line drawing subroutine

123                             ;;============================================================================
123                             ;; Check Collisions - Check Collisions Subroutine
123                             ;;============================================================================

123            check_collision:
123                             ;;============================================================================
123                             ;; Check Collisions with Map (top wall)
123                             ;;============================================================================
123  0150F                      LOAD s5, 0F                    ; top wall vertical coordinate (15)
124  006C0                      LOAD s6, sc                    ; get vertical position of helicopter
125  1960A                      SUB s6, 0A                     ; the helicopter's blades 10 pixels higher
126  1C560                      COMPARE s5, s6                 ; check if the two intersect
127  32141                      JUMP Z, collision_occurred     ; jump to collision occurred
128  3E141                      JUMP NC, collision_occurred    ; jump to collision occurred (necessary)

129                             ;;============================================================================
129                             ;; Check Collisions with Map (bottom wall)
129                             ;;============================================================================
129  015F0                      LOAD s5, F0                    ; bottom wall vertical coordinate (240)
12A  006C0                      LOAD s6, sc                    ; get vertical position of helicopter
12B  11605                      ADD s6, 05                     ; the helicopter's bottom is 5 pixels below
12C  1C560                      COMPARE s5, s6                 ; check if the two intersect
12D  32141                      JUMP Z, collision_occurred     ; jump to collision occurred

12E                             ;;============================================================================
12E                             ;; Check Collisions with Block
12E                             ;;============================================================================

12E  005E0                      LOAD s5, se                    ; get current horizontal position of block
12F  1950A                      SUB s5, 0A                     ; actual block is 10 pixels back
130  1D564                      COMPARE s5, 64                 ; check if s5 coincides with heli (horizontal check)
131  32133                      JUMP Z, check_vertical         ; jump to check vertical positioning
132  3613D                      JUMP NZ, no_collision          ; jump to no_collision routine

133             check_vertical:
133  006F0                      LOAD s6, sf                    ; get current vertical position of block
134  007C0                      LOAD s7, sc                    ; load helicopter front position
135  1C760                loop: COMPARE s7, s6                 ; compare s7 and s6
136  32141                      JUMP Z, collision_occurred     ; jump to collision_occured
137  11601                      ADD s6, 01                     ; add one to s6
138  008F0                      LOAD s8, sf                    ; load original value for reference only
139  1183C                      ADD s8, 3c                     ; add 60 to s8
13A  1C680                      COMPARE s6, s8                 ; compare s6 to bottom of block (s8)
13B  3213D                      JUMP Z, no_collision           ; jump to no_collision routine
13C  36135                      JUMP NZ, loop                  ; keep looping

13D  19E01        no_collision: SUB se, 01                     ; decrement sE
13E  11C01                      ADD sc, 01                     ; increment sC
13F  20149                      CALL distance                  ; used for keeping the score (increments distance)
140  25000                      RETURN                         ; leave, since no collisions occurred

141         collision_occurred:
141  2D500                      OUTPUT s5, stax                ; set desired stax
142  2D701                      OUTPUT s7, stay                ; set desired stay
143  09807                      INPUT s8, prng                 ; load random endx
144  2D802                      OUTPUT s8, endx                ; set random endx
145  09807                      INPUT s8, prng                 ; load random endy
146  2D803                      OUTPUT s8, endy                ; set random endy
147  2011D                      CALL draw_line                 ; draw random line
148  25000                      RETURN                         ; return from routine without any increments

149                             ;;============================================================================
149                             ;; Distance - Distance Subroutine
149                             ;;============================================================================

149  2DB0A            distance: OUTPUT sb, qssd_lo             ; put distance value to qssd
14A  1DBFF                      COMPARE sb, FF                 ; check if max (99) was reached
14B  3214E                      JUMP Z, distance2              ; jump to distance2
14C  11B01                      ADD sb, one                    ; increment distance value
14D  25000                      RETURN                         ; finished with distance subroutine

14E  11A01           distance2: ADD sa, one                    ; add one to the next degree
14F  01B00                      LOAD sb, zero                  ; reset sB
150  2DB0A                      OUTPUT sb, qssd_lo             ; put distance value to qssd
151  2DA0B                      OUTPUT sa, qssd_hi             ; put distance value to qssd
152  25000                      RETURN                         ; finished with distance subroutine

7FF                             ;;============================================================================
7FF                             ;; Interrupt - Vector.
7FF                             ;;============================================================================

7FF                             ADDRESS 7FF                    ; must be located here
7FF  22013          isr_vector: JUMP isr                       ; always jump to isr

800                             ;;============================================================================
800                             ;;
800                             ;;============================================================================


PSM files that have been assembled
----------------------------------
    /home/adnan/Documents/School/EE178/fpga_video_game/latest_fpga_video_game/software/software.psm


List of defined constants
-------------------------
   CONSTANT name      Value  Source PSM file
   -------------      -----  ---------------
   BEL                07
   BS                 08
   CR                 0D
   DCS                90
   DEL                7F
   ESC                1B
   HT                 09
   LF                 0A
   NUL                00
   ST                 9C
   VT                 0B
   beam               05     software.psm
   beam_hi            0f     software.psm
   beam_lo            03     software.psm
   beam_md            07     software.psm
   busy               04     software.psm
   busy_go            01     software.psm
   buttons            0f     software.psm
   buttons_ct         10     software.psm
   buttons_dn         04     software.psm
   buttons_lf         02     software.psm
   buttons_rt         01     software.psm
   buttons_up         08     software.psm
   datestamp_day      1D
   datestamp_month    0B
   datestamp_year     0F
   endx               02     software.psm
   endy               03     software.psm
   leds_hi            09     software.psm
   leds_lo            08     software.psm
   mode               06     software.psm
   mode_clr           01     software.psm
   mode_exp           03     software.psm
   mode_hld           00     software.psm
   mode_lin           02     software.psm
   one                01     software.psm
   prng               07     software.psm
   qssd_dp            0c     software.psm
   qssd_hi            0b     software.psm
   qssd_lo            0a     software.psm
   stax               00     software.psm
   stay               01     software.psm
   switches_hi        0e     software.psm
   switches_lo        0d     software.psm
   timestamp_hours    0C
   timestamp_minutes  1F
   timestamp_seconds  24
   zero               00     software.psm


  No tables defined


List of text strings
--------------------
   STRING name  Value          Source PSM file
   -----------  -----          ---------------
   datestamp$   "29 Nov 2015"
   timestamp$   "12:31:36"


List of line labels
-------------------
    Label                    Addr  Source PSM file
 --------                    ----  ---------------
 *  boot                     000   software.psm
    check_collision          123   software.psm
    check_other_bound_range  06D   software.psm
    check_vertical           133   software.psm
    collision_occurred       141   software.psm
    decrement                075   software.psm
    distance                 149   software.psm
    distance2                14E   software.psm
    draw_block               038   software.psm
    draw_helicopter          033   software.psm
    draw_helicopter_blades   0EB   software.psm
    draw_helicopter_cockpit  077   software.psm
    draw_helicopter_smoke    0FF   software.psm
    draw_helicopter_tail     0B6   software.psm
    draw_line                11D   software.psm
    finished1                04C   software.psm
    in_middle                049   software.psm
    isr                      013   software.psm
 *  isr_vector               7FF   software.psm
    left_edge                045   software.psm
    loop                     135   software.psm
    main                     00F   software.psm
    map                      022   software.psm
    move_heli_up             071   software.psm
    new_random               069   software.psm
    no_collision             13D   software.psm
    play                     018   software.psm
    random_block_location    065   software.psm
    right_edge               041   software.psm
    skip_everything          068   software.psm
    wait                     11F   software.psm

       * Unreferenced label(s)


List of pragma blocks
---------------------
   Name  Addr range  Value
   ----  ----------  -----


Instruction usage statistics
----------------------------
   Instruction  Instances
   -----------  ---------
   ADD          17
   ADDCY        -
   AND          -
   CALL         35
   CALL@        -
   COMPARE      14
   COMPARECY    -
   DISABLE      -
   ENABLE       1
   FETCH        -
   HWBUILD      -
   INPUT        11
   JUMP         25
   JUMP@        -
   LOAD         69
   LOAD&RETURN  -
   OR           -
   OUTPUT       101
   OUTPUTK      -
   REGBANK      -
   RETURN       17
   RETURNI      1
   RL           -
   RR           -
   SL0          -
   SL1          -
   SLA          -
   SLX          -
   SR0          -
   SR1          -
   SRA          -
   SRX          -
   STAR         -
   STORE        -
   SUB          49
   SUBCY        -
   TEST         -
   TESTCY       -
   XOR          -
